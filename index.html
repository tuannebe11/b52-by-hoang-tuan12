<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>B52 Crash Game</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: radial-gradient(circle at center, #0a0a23 0%, #000 100%);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }

    header {
      font-size: 28px;
      font-weight: bold;
      padding: 15px;
      color: #00ffd0;
    }

    #game-area {
      position: relative;
      width: 700px;
      height: 400px;
      background: url('background.png') center/cover no-repeat;
      border: 3px solid #444;
      border-radius: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 0 30px rgba(0,255,255,0.2);
      overflow: hidden;
    }

    #plane {
      position: absolute;
      bottom: 20px;
      left: 60px;
      width: 120px;
      transition: transform 0.1s linear;
    }

    #multiplier {
      font-size: 48px;
      font-weight: bold;
      margin-bottom: 10px;
      color: #00ffd0;
      text-shadow: 0 0 8px #00ffd0;
    }

    #controls {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 15px;
    }

    button {
      padding: 12px 28px;
      font-size: 18px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }

    #stop-btn {
      background: #ff4136;
      color: white;
    }

    #bet-btn {
      background: #2ecc40;
      color: white;
    }

    #balance {
      font-size: 18px;
      margin-bottom: 10px;
    }

    input[type="number"] {
      width: 100px;
      padding: 10px;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid #aaa;
      background: #222;
      color: #fff;
    }

    #require-join, #join-telegram {
      text-align: center;
      margin-top: 40px;
    }

    .telegram-btn {
      background: #00ffd0;
      padding: 14px 28px;
      color: #000;
      font-size: 18px;
      font-weight: bold;
      border-radius: 8px;
      text-decoration: none;
      transition: 0.3s;
      display: inline-block;
      cursor: pointer;
    }

    .telegram-btn:hover {
      background: #00cba0;
    }

    #balance, #controls, #multiplier, #game-area {
      display: none;
    }
  </style>
</head>
<body>

  <header>
    <img src="b52-plane-icon.png" alt="B52 Plane Icon" style="height: 50px; vertical-align: middle;">
    B52 CRASH GAME
  </header>

  <!-- Y√™u c·∫ßu b·∫Øt bu·ªôc tham gia ƒë·ªÉ b·∫Øt ƒë·∫ßu -->
  <div id="require-join">
    <p>üéØ B·∫°n c·∫ßn tham gia nh√≥m Telegram ƒë·ªÉ ch∆°i game:</p>
    <a href="https://t.me/htuanpremium0" target="_blank" class="telegram-btn" onclick="markJoined()">Tham gia ngay</a>
  </div>

  <!-- Khi h·∫øt xu: hi·ªán ƒë·ªÉ nh·∫≠n l·∫°i xu -->
  <div id="join-telegram" style="display: none;">
    <p>üí∏ B·∫°n ƒë√£ h·∫øt xu! Tham gia nh√≥m Telegram sau ƒë·ªÉ nh·∫≠n l·∫°i 10.000 ƒë:</p>
    <a href="https://t.me/htuanpremium1" target="_blank" class="telegram-btn" onclick="restoreBalance()">Nh·∫≠n l·∫°i xu</a>
  </div>

  <div id="balance">S·ªë d∆∞: <span id="balance-value">0</span> ƒë</div>

  <div id="controls">
    <input type="number" id="bet-amount" placeholder="M·ª©c c∆∞·ª£c" min="100" max="10000" value="1000">
    <button id="bet-btn">ƒê·∫∂T C∆Ø·ª¢C</button>
    <button id="stop-btn" disabled>D·ª™NG</button>
  </div>

  <div id="multiplier">x1.00</div>

  <div id="game-area">
    <img id="plane" src="b52-plane-icon.png" alt="B52 Plane Icon" />
  </div>

  <script>
    const plane = document.getElementById("plane");
    const multiplierEl = document.getElementById("multiplier");
    const stopBtn = document.getElementById("stop-btn");
    const betBtn = document.getElementById("bet-btn");
    const betAmountInput = document.getElementById("bet-amount");
    const balanceValue = document.getElementById("balance-value");
    const telegramPrompt = document.getElementById("join-telegram");
    const requireJoin = document.getElementById("require-join");

    let multiplier = 1.0;
    let interval;
    let crashed = false;
    let betPlaced = false;
    let cashedOut = false;
    let balance = 0;
    let betAmount = 0;
    let gameLocked = false;

    // Khi load trang
    window.addEventListener("load", () => {
      if (localStorage.getItem("joinedMainTelegram") !== "true") {
        showRequireJoin();
        return;
      }

      if (sessionStorage.getItem("balance") !== null) {
        balance = parseInt(sessionStorage.getItem("balance"));
      } else {
        balance = 10000;
        sessionStorage.setItem("balance", balance);
      }

      balanceValue.textContent = balance;
      if (balance <= 0) {
        lockGame();
      } else {
        showGame();
      }
    });

    function showRequireJoin() {
      requireJoin.style.display = "block";
      document.getElementById("balance").style.display = "none";
      document.getElementById("controls").style.display = "none";
      document.getElementById("multiplier").style.display = "none";
      document.getElementById("game-area").style.display = "none";
    }

    function markJoined() {
      localStorage.setItem("joinedMainTelegram", "true");
      setTimeout(() => {
        location.reload();
      }, 1000);
    }

    function showGame() {
      requireJoin.style.display = "none";
      telegramPrompt.style.display = "none";
      document.getElementById("balance").style.display = "block";
      document.getElementById("controls").style.display = "flex";
      document.getElementById("multiplier").style.display = "block";
      document.getElementById("game-area").style.display = "flex";
    }

    function lockGame() {
      gameLocked = true;
      betBtn.disabled = true;
      telegramPrompt.style.display = "block";
      document.getElementById("balance").style.display = "none";
      document.getElementById("controls").style.display = "none";
      document.getElementById("multiplier").style.display = "none";
      document.getElementById("game-area").style.display = "none";
    }

    function restoreBalance() {
      if (localStorage.getItem("joinedBonusTelegram") === "true") {
        alert("‚ùó B·∫°n ƒë√£ nh·∫≠n xu tr∆∞·ªõc ƒë√≥ r·ªìi.");
        return;
      }

      balance = 10000;
      sessionStorage.setItem("balance", balance);
      balanceValue.textContent = balance;
      localStorage.setItem("joinedBonusTelegram", "true");
      gameLocked = false;
      betBtn.disabled = false;
      alert("‚úÖ B·∫°n ƒë√£ nh·∫≠n l·∫°i 10.000 ƒë. Ti·∫øp t·ª•c ch∆°i nh√©!");
      showGame();
    }

    function startGame() {
      crashed = false;
      cashedOut = false;
      multiplier = 1.0;
      updateMultiplier();
      plane.style.transform = `translateY(0)`;

      const crashPoint = Math.random() * 3 + 1.2;
      interval = setInterval(() => {
        if (crashed || cashedOut) return;

        multiplier += 0.01 + multiplier * 0.01;
        multiplier = Math.round(multiplier * 100) / 100;
        updateMultiplier();

        const y = -multiplier * 10;
        plane.style.transform = `translateY(${y}px)`;

        if (multiplier >= crashPoint) {
          crash();
        }
      }, 100);
    }

    function updateMultiplier() {
      multiplierEl.textContent = `x${multiplier.toFixed(2)}`;
    }

    function crash() {
      clearInterval(interval);
      crashed = true;
      stopBtn.disabled = true;
      alert("üí• M√°y bay ƒë√£ n·ªï! B·∫°n thua c∆∞·ª£c.");
      checkAfterCrash();
    }

    function cashOut() {
      if (crashed || cashedOut) return;
      cashedOut = true;
      clearInterval(interval);

      const profit = Math.floor(betAmount * multiplier);
      balance += profit;
      sessionStorage.setItem("balance", balance);
      balanceValue.textContent = balance;
      stopBtn.disabled = true;
      alert(`‚úÖ B·∫°n ƒë√£ d·ª´ng t·∫°i x${multiplier.toFixed(2)} v√† nh·∫≠n ${profit} ƒë!`);
      resetForNextRound();
    }

    function resetForNextRound() {
      betPlaced = false;
      stopBtn.disabled = true;
      plane.style.transform = `translateY(0)`;
      multiplier = 1.0;
      updateMultiplier();
    }

    function checkAfterCrash() {
      resetForNextRound();
      if (balance <= 0) {
        lockGame();
      }
    }

    betBtn.onclick = () => {
      if (gameLocked || betPlaced) return;

      betAmount = parseInt(betAmountInput.value);
      if (isNaN(betAmount) || betAmount > balance || betAmount < 100) {
        alert("‚ùå S·ªë ti·ªÅn c∆∞·ª£c kh√¥ng h·ª£p l·ªá.");
        return;
      }

      balance -= betAmount;
      sessionStorage.setItem("balance", balance);
      balanceValue.textContent = balance;

      betPlaced = true;
      stopBtn.disabled = false;
      startGame();
    };

    stopBtn.onclick = cashOut;
  </script>
</body>
</html>
